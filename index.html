<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Cloud Memo</title>
  <style>
    body {
      max-width: 600px;
      margin: 40px auto;
      font-family: sans-serif;
      padding: 0 20px;
    }
    textarea {
      width: 100%;
      height: 150px;
      padding: 12px;
      font-size: 16px;
      box-sizing: border-box;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    button {
      margin-top: 10px;
      padding: 10px 18px;
      font-size: 16px;
      cursor: pointer;
      background: #0070f3;
      color: white;
      border: none;
      border-radius: 4px;
    }
    button:hover {
      background: #0051cc;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .saved {
      margin-top: 10px;
      color: green;
    }
    .error {
      margin-top: 10px;
      color: red;
    }
    .link {
      margin-top: 20px;
    }
    .link a {
      color: #0070f3;
      text-decoration: none;
    }
    .link a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <h1>Cloud Memo</h1>
  <textarea id="memo" placeholder="여기에 메모를 입력하세요"></textarea>
  <br />
  <button id="saveBtn">메모 저장하기</button>
  <div id="status"></div>
  <div class="link">
    <a href="/view">저장된 메모 보기 →</a>
  </div>

  <script>
    const WORKER_URL = "https://memo.seliscos.workers.dev/api/notes";
    
    const memoInput = document.getElementById("memo");
    const saveBtn = document.getElementById("saveBtn");
    const statusDiv = document.getElementById("status");

    saveBtn.addEventListener("click", async () => {
      const memoText = memoInput.value.trim();
      
      if (!memoText) {
        statusDiv.innerHTML = "<span class='error'>메모가 비어 있습니다.</span>";
        return;
      }

      // 저장 중 UI
      saveBtn.disabled = true;
      saveBtn.textContent = "저장 중...";
      statusDiv.innerHTML = "";

      try {
        const response = await fetch(WORKER_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            content: memoText,
          }),
        });

        const data = await response.json();

        if (!response.ok || data.error) {
          throw new Error(data.error || '저장에 실패했습니다.');
        }

        // 성공
        statusDiv.innerHTML = "<span class='saved'>✓ 저장되었습니다!</span>";
        memoInput.value = "";
        
        // 3초 후 메시지 제거
        setTimeout(() => {
          statusDiv.innerHTML = "";
        }, 3000);

      } catch (error) {
        statusDiv.innerHTML = `<span class='error'>저장 실패: ${error.message}</span>`;
      } finally {
        saveBtn.disabled = false;
        saveBtn.textContent = "메모 저장하기";
      }
    });

    // Enter + Ctrl/Cmd로 저장
    memoInput.addEventListener("keydown", (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
        saveBtn.click();
      }
    });
  </script>
</body>
</html>